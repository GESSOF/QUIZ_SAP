<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz 050 - Restricciones y Claves Foráneas SAP HANA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }

        .stat-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }

        .content {
            padding: 40px;
        }

        .question-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
            display: none;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.5s ease;
        }

        .question-card.active {
            display: block;
            transform: translateY(0);
            opacity: 1;
        }

        .question-number {
            color: #667eea;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 25px;
            line-height: 1.4;
            color: #333;
        }

        .options {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }

        .option {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .option:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .option.correct {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }

        .option.incorrect {
            border-color: #f44336;
            background: linear-gradient(135deg, #f44336 0%, #da190b 100%);
            color: white;
        }

        .buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .explanation {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            border-left: 4px solid #4CAF50;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .explanation.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .explanation h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .final-score {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            margin-top: 30px;
        }

        .final-score.show {
            display: block;
            animation: slideIn 0.5s ease;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5em;
            font-weight: bold;
            backdrop-filter: blur(10px);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border-radius: 4px;
            transition: width 0.8s ease;
        }

        .study-tips {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-left: 4px solid #ff9800;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .study-tips h4 {
            color: #e65100;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .study-tips ul {
            margin-left: 20px;
        }

        .study-tips li {
            margin-bottom: 8px;
            color: #bf360c;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                margin: 0;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .content {
                padding: 20px;
            }
            
            .question-card {
                padding: 20px;
            }
            
            .stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .stat-item {
                padding: 12px 20px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 1em;
            }
            
            .question-text {
                font-size: 1.1em;
            }
            
            .option {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5em;
            }
            
            .content {
                padding: 15px;
            }
            
            .question-card {
                padding: 15px;
            }
            
            .score-circle {
                width: 120px;
                height: 120px;
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Quiz 050 | SAP HANA</h1>
            <p>Restricciones a Nivel de Tabla y Claves Foráneas</p>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-number" id="currentQuestion">1</span>
                    <span>Pregunta</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalQuestions">8</span>
                    <span>Total</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="score">0</span>
                    <span>Puntaje</span>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="content">
            <div id="questionContainer"></div>
            
            <div class="final-score" id="finalScore">
                <div class="score-circle" id="finalScoreCircle">0%</div>
                <h2>¡Quiz Completado!</h2>
                <p id="scoreMessage"></p>
                <button class="btn btn-primary" onclick="restartQuiz()">Reiniciar Quiz</button>
            </div>
        </div>
    </div>

    <script>
        const questionsBase = [
            {
                question: "¿Cuál es la diferencia entre UNIQUE (valor1, valor2) y UNIQUE (valor1), UNIQUE (valor2)?",
                options: [
                    "No hay diferencia, ambos funcionan igual",
                    "UNIQUE (valor1, valor2) evalúa el conjunto como unidad, UNIQUE individuales evalúan cada campo por separado",
                    "UNIQUE (valor1, valor2) es más rápido en rendimiento",
                    "UNIQUE individuales no permiten valores NULL"
                ],
                correct: 1,
                explanation: "UNIQUE (valor1, valor2) permite que cada valor individual se repita siempre que el conjunto sea único. Con UNIQUE individuales, cada campo debe ser único por separado, sin posibilidad de repetición."
            },
            {
                question: "¿En qué orden deben crearse las tablas cuando se establecen claves foráneas?",
                options: [
                    "Primero la tabla hija, después la tabla padre",
                    "El orden no importa en SAP HANA",
                    "Primero la tabla padre (referenciada), después la tabla hija (que referencia)",
                    "Ambas tablas deben crearse simultáneamente"
                ],
                correct: 2,
                explanation: "La tabla padre (que contiene la clave primaria referenciada) debe existir antes de crear la tabla hija que la referencia mediante FOREIGN KEY. Sin esto, la base de datos no puede validar la integridad referencial."
            },
            {
                question: "¿Cuántas claves primarias (PRIMARY KEY) puede tener una tabla?",
                options: [
                    "Hasta 5 claves primarias por tabla",
                    "Solo una clave primaria por tabla",
                    "Depende del número de columnas de la tabla",
                    "Ilimitadas, pero se recomienda máximo 3"
                ],
                correct: 1,
                explanation: "Cada tabla puede tener únicamente una clave primaria. Sin embargo, esta clave primaria puede ser compuesta (formada por múltiples campos que juntos identifican unívocamente cada registro)."
            },
            {
                question: "¿Qué tipo de fichero se utiliza específicamente para definir claves foráneas en SAP HANA?",
                options: [
                    ".hdbtable",
                    ".hdbconstraint",
                    ".hdbview",
                    ".hdbprocedure"
                ],
                correct: 1,
                explanation: "Los ficheros .hdbconstraint se utilizan específicamente para definir restricciones como claves foráneas en SAP HANA, separando la definición de la tabla (.hdbtable) de sus restricciones."
            },
            {
                question: "Si una tabla tiene UNIQUE (valor1, valor2) y ya existe el registro (1, 1, 3), ¿cuál de estas inserciones será rechazada?",
                options: [
                    "(1, 2, 3) - será rechazada",
                    "(2, 1, 3) - será rechazada", 
                    "(1, 1, 5) - será rechazada",
                    "(3, 3, 1) - será rechazada"
                ],
                correct: 2,
                explanation: "Con UNIQUE (valor1, valor2), el conjunto (1, 1) ya existe, por lo que cualquier intento de insertar otro registro con valor1=1 y valor2=1 será rechazado, sin importar el valor del tercer campo."
            },
            {
                question: "¿Qué garantiza principalmente una FOREIGN KEY en una base de datos?",
                options: [
                    "Que los datos se almacenen más rápido",
                    "Integridad referencial - que los valores en la tabla hija existan en la tabla padre",
                    "Que no se puedan insertar registros duplicados",
                    "Que las consultas sean más eficientes"
                ],
                correct: 1,
                explanation: "La FOREIGN KEY garantiza integridad referencial, asegurando que no se puedan insertar valores en la tabla hija que no existan en la tabla padre, manteniendo la consistencia de las relaciones entre tablas."
            },
            {
                question: "¿Cuál es la diferencia principal entre usar SQL directo vs ficheros para implementar claves foráneas?",
                options: [
                    "SQL directo es más rápido en ejecución",
                    "Los ficheros requieren tres archivos separados: .hdbtable (padre), .hdbtable (hija) y .hdbconstraint",
                    "SQL directo no permite ON DELETE CASCADE",
                    "Los ficheros solo funcionan en versiones antiguas de HANA"
                ],
                correct: 1,
                explanation: "El enfoque con ficheros en SAP HANA requiere separar la definición en múltiples archivos: las tablas en ficheros .hdbtable y las restricciones en ficheros .hdbconstraint, proporcionando mejor organización y control de versiones."
            },
            {
                question: "¿Qué función cumple la cláusula ON DELETE CASCADE en una clave foránea?",
                options: [
                    "Impide que se eliminen registros de la tabla padre",
                    "Elimina automáticamente los registros relacionados en la tabla hija cuando se elimina el registro padre",
                    "Crea una copia de seguridad antes de eliminar",
                    "Convierte la eliminación en una actualización"
                ],
                correct: 1,
                explanation: "ON DELETE CASCADE establece que cuando se elimina un registro de la tabla padre, todos los registros relacionados en la tabla hija se eliminarán automáticamente, propagando la acción de eliminación."
            }
        ];

        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let score = 0;

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function randomizeQuestions() {
            questions = questionsBase.map(q => {
                const correctAnswer = q.options[q.correct];
                const shuffledOptions = shuffleArray(q.options);
                const newCorrectIndex = shuffledOptions.indexOf(correctAnswer);
                
                return {
                    ...q,
                    options: shuffledOptions,
                    correct: newCorrectIndex
                };
            });
        }

        function initQuiz() {
            randomizeQuestions();
            currentQuestionIndex = 0;
            userAnswers = [];
            score = 0;
            displayQuestion();
            updateProgress();
        }

        function displayQuestion() {
            const container = document.getElementById('questionContainer');
            const question = questions[currentQuestionIndex];
            
            container.innerHTML = `
                <div class="question-card active">
                    <div class="question-number">Pregunta ${currentQuestionIndex + 1} de ${questions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="options" id="options">
                        ${question.options.map((option, index) => `
                            <div class="option" onclick="selectOption(${index})" data-index="${index}">
                                <strong>${String.fromCharCode(65 + index)})</strong> ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div class="explanation" id="explanation">
                        <h4>💡 Explicación:</h4>
                        <p>${question.explanation}</p>
                    </div>
                    <div class="buttons">
                        <button class="btn btn-secondary" onclick="previousQuestion()" ${currentQuestionIndex === 0 ? 'disabled' : ''}>
                            ← Anterior
                        </button>
                        <button class="btn btn-primary" onclick="submitAnswer()" id="submitBtn" disabled>
                            Confirmar Respuesta
                        </button>
                        <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn" style="display: none;">
                            ${currentQuestionIndex === questions.length - 1 ? 'Ver Resultados' : 'Siguiente →'}
                        </button>
                    </div>
                </div>
            `;
            
            // Restore previous answer if exists
            if (userAnswers[currentQuestionIndex] !== undefined) {
                selectOption(userAnswers[currentQuestionIndex]);
                submitAnswer();
            }
        }

        function selectOption(index) {
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            options[index].classList.add('selected');
            
            document.getElementById('submitBtn').disabled = false;
        }

        function submitAnswer() {
            const selectedOption = document.querySelector('.option.selected');
            if (!selectedOption) return;
            
            const selectedIndex = parseInt(selectedOption.dataset.index);
            const question = questions[currentQuestionIndex];
            
            userAnswers[currentQuestionIndex] = selectedIndex;
            
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                option.onclick = null;
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedIndex && index !== question.correct) {
                    option.classList.add('incorrect');
                }
            });
            
            document.getElementById('explanation').classList.add('show');
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                updateProgress();
            } else {
                showFinalScore();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
                updateProgress();
            }
        }

        function updateProgress() {
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Update score
            score = userAnswers.filter((answer, index) => answer === questions[index].correct).length;
            document.getElementById('score').textContent = score;
        }

        function showFinalScore() {
            const finalScore = Math.round((score / questions.length) * 100);
            
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('finalScore').classList.add('show');
            document.getElementById('finalScoreCircle').textContent = finalScore + '%';
            
            let message = '';
            if (finalScore >= 80) {
                message = '🎉 ¡Excelente! Dominas las restricciones y claves foráneas en SAP HANA.';
            } else if (finalScore >= 60) {
                message = '👍 Buen trabajo. Repasa los conceptos de UNIQUE y FOREIGN KEY.';
            } else {
                message = '⚠️ Es importante dominar estos conceptos de modelado de bases de datos.';
            }
            
            document.getElementById('scoreMessage').innerHTML = `
                <p>${message}</p>
                <div class="study-tips">
                    <h4>🔗 Conceptos clave de Restricciones y Claves Foráneas:</h4>
                    <ul>
                        <li><strong>UNIQUE combinado:</strong> UNIQUE (campo1, campo2) evalúa el conjunto como unidad</li>
                        <li><strong>UNIQUE individual:</strong> Cada campo debe ser único por separado</li>
                        <li><strong>PRIMARY KEY:</strong> Solo una por tabla, puede ser compuesta</li>
                        <li><strong>FOREIGN KEY:</strong> Garantiza integridad referencial entre tablas</li>
                        <li><strong>Orden crítico:</strong> Tabla padre ANTES que tabla hija</li>
                        <li><strong>Ficheros SAP HANA:</strong> .hdbtable para tablas, .hdbconstraint para FK</li>
                        <li><strong>ON DELETE CASCADE:</strong> Propagación automática de eliminaciones</li>
                        <li><strong>Integridad referencial:</strong> Valores en tabla hija deben existir en tabla padre</li>
                    </ul>
                </div>
            `;
        }

        function restartQuiz() {
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('finalScore').classList.remove('show');
            
            initQuiz();
        }

        // Initialize quiz when page loads
        window.onload = initQuiz;
    </script>
</body>
</html>